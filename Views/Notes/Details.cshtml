@model OnlineNotes.Models.Note

@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

@*Makes the text warp to prevent horizontal scrolling*@
<style>
    pre {
        overflow-x: auto;
        white-space: pre-wrap;
    }
</style>

<div>
    <h4>Note</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Title)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Title)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Contents)
        </dt>
        <dd class = "col-sm-12">
            <pre>@Html.DisplayFor(model => model.Contents)</pre>
        </dd>

        <div align="right" background: blue> <b>@ViewBag.Count words</b></div>

        <div id="explainField" hidden>
            <dt class="col-sm-2">
                Explained like you're 5
            </dt>
            <dd class="col-sm-12" id="resultField">
                
            </dd>
        </div>

    </dl>
</div>

<div>
    <h4>Comments</h4>
    <hr />
   
    @if (Model.Comments.Any())
    {
        <a class="btn btn-primary btn-sm" asp-controller="Comments" asp-action="Filter" asp-route-noteId="@Model.Id">Filter</a>
        <table class="table">
            <tr>
                <th></th>
                <th>Date Created</th>
                <th></th>
            </tr>
            <tbody>
            @foreach (var comment in Model.Comments)
            {
                <tr>
                    <td>
                        @comment.Contents
                    </td>
                    <td>
                        @comment.CreationDate
                    </td>
                    <td>
                            <a class="btn btn-danger btn-sm" asp-controller="Comments" asp-action="Delete" asp-route-Id="@comment.Id">Delete</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    } else
    {
        <p> There are no comments to display</p>
    }
</div>

<div>
    <button class="btn btn-info" id="explainButton" style="margin-bottom:10px">Explain it like im 5</button>
</div>
<div>
    <a class="btn btn-secondary" asp-action="Edit" asp-route-id="@Model?.Id">Edit</a>
    <a class="btn btn-primary" asp-action="Index">Back to List</a>
    <a class="btn btn-outline-info" asp-controller="Comments" asp-action="Create" asp-route-noteId="@Model?.Id">Write a comment</a>
</div>

@section scripts {
    <script>
        document.getElementById("explainButton").addEventListener("click", function () {
            // Get the user input from the text input field
            var userInput = "explain it like im 5: @Model.Contents";

            // Send a request to the action with the user input
            fetch('@Url.Action("ExplainTask", "Notes")?input=' + encodeURIComponent(userInput))
                .then(response => response.text())
                .then(text => {
                    document.getElementById("explainField").removeAttribute("hidden");
                    // Display the returned text in the resultDiv
                    document.getElementById("resultField").innerText = text;
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>
}
